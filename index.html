<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wing Foil – Simulador (v23h7)</title>
  <style>
    :root{ --left-w: 320px; --right-w: 270px; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#fafafa;color:#111}
    .wrap{display:grid;grid-template-columns: var(--left-w) 1fr var(--right-w); min-height:100vh;}
    .col{padding:14px 16px}
    .left{background:#fff;border-right:1px solid #e6e6e6}
    .center{background:#fff}
    .right{background:#fff;border-left:1px solid #e6e6e6}
    h1{font-size:18px;margin:8px 0 12px}
    .section{margin-bottom:14px}
    .row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;margin:2px 0}
    label{font-size:10px;color:#444;line-height:1.0}
    input[type=range]{width:120px;height:6px}
    input[type=range]::-webkit-slider-runnable-track{height:4px}
    input[type=range]::-webkit-slider-thumb{height:6px;width:6px;margin-top:-1px;-webkit-appearance:none;border-radius:0;background:#666;clip-path:polygon(50% 0%,0% 100%,100% 100%)}
    input[type=range]::-moz-range-track{height:4px}
    input[type=range]::-moz-range-thumb{height:6px;width:6px;border:none;border-radius:0;background:#666;clip-path:polygon(50% 0%,0% 100%,100% 100%)}
    select{padding:2px 6px;font-size:10px}
    .diagram{height:58vh; min-height:380px; border:1px solid #eee;border-radius:8px}
    svg{width:100%;height:100%}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px}
    .btn{padding:6px 10px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .kpis{display:flex;flex-direction:column;gap:8px}
    .kpi{display:flex;justify-content:space-between;align-items:center;border:1px solid #eee;border-radius:8px;padding:4px 6px}
    .kpi .h{font-size:10px;color:#666}.kpi .v{font-weight:700;min-width:60px;text-align:right;font-size:12px}
    .checks{display:grid;grid-template-columns:1fr;gap:6px;font-size:13px}
    .chartbox{height:150px;border:1px solid #eee;border-radius:8px;margin-top:8px}
    .chartbox svg{width:100%;height:100%}
  </style>
</head>
<body>
<div class="wrap">
  <div class="col left">
    <h1>Parámetros</h1>
    <div class="section">
      <div class="row"><label title="Velocidad base V₀ (m/s). Velocidad media de la corriente relativa. V(t) = V₀ + A_V·sin(2πft)">V₀ (m/s) <b id="v0v"></b></label><input id="v0" type="range" min="2" max="6" step="0.1" value="3.5"></div>
      <div class="row"><label title="Ángulo de pitch base φ (°). Ángulo de inclinación base de la tabla. Positivo cuando la proa está arriba (sentido antihorario desde eje horizontal). Convención aerodinámica estándar.">φ base (°) <b id="phiv"></b></label><input id="phi" type="range" min="-10" max="15" step="0.1" value="3"></div>
      <div class="row"><label title="Ángulo de ataque base θ₀ (°). Ángulo base de la cuerda del ala. Positivo cuando el borde de ataque está arriba (sentido antihorario desde eje horizontal). Convención aerodinámica estándar.">θ₀ base (°) <b id="thetav"></b></label><input id="theta0" type="range" min="-5" max="12" step="0.1" value="3.5"></div>
      <div class="row"><label title="Ángulo de flujo base γ₀ (°). Ángulo base de la velocidad relativa del flujo. Positivo cuando el flujo viene desde arriba (sentido antihorario desde eje horizontal).">γ₀ (°) <b id="gammav"></b></label><input id="gamma0" type="range" min="-15" max="10" step="0.1" value="-2"></div>
      <div class="row"><label title="Superficie alar S (m²). Área proyectada del ala del foil. Superficie efectiva para generar sustentación.">S (m²) <b id="Sv"></b></label><input id="S" type="range" min="0.08" max="0.22" step="0.005" value="0.14"></div>
      <div class="row"><label title="Densidad del agua ρ (kg/m³). Densidad del fluido (agua). Afecta la sustentación y resistencia hidrodinámica.">ρ (kg/m³) <b id="rhov"></b></label><input id="rho" type="range" min="950" max="1030" step="1" value="1000"></div>
      <div class="row"><label title="Masa total (kg). Masa total del sistema (rider + equipo). Afecta la dinámica y fuerzas gravitatorias.">Masa (kg) <b id="massv"></b></label><input id="mass" type="range" min="55" max="110" step="1" value="82"></div>
      <div class="row"><label title="Relación L/D (adimensional). Relación entre sustentación y resistencia. Mayor valor indica mejor eficiencia aerodinámica.">L/D <b id="LDv"></b></label><input id="LD" type="range" min="4" max="12" step="0.1" value="7"></div>
      <div class="row"><label title="Pendiente dCL/dα (1/°). Derivada del coeficiente de sustentación respecto al ángulo de ataque. Medida en grados.">CL/° <b id="clslopev"></b></label><input id="clslope" type="range" min="0.04" max="0.14" step="0.001" value="0.10"></div>
      <div class="row"><label title="CL máximo (adimensional). Coeficiente de sustentación máximo antes de entrada en pérdida.">CLmáx <b id="clmaxv"></b></label><input id="clmax" type="range" min="0.7" max="1.5" step="0.05" value="1.1"></div>
      <div class="row"><label title="Ángulo de pérdida α* (°). Ángulo de ataque donde comienza la pérdida aerodinámica. Positivo según convención estándar.">α* pérdida (°) <b id="stallv"></b></label><input id="stall" type="range" min="6" max="16" step="0.5" value="12"></div>
    </div>

    <h1>Ciclo</h1>
    <div class="section">
      <div class="row"><label title="Frecuencia de bombeo f (Hz). Frecuencia de oscilación del sistema. Tc = 1/f es el período del ciclo.">f (Hz) <b id="freqv"></b></label><input id="freq" type="range" min="0.6" max="2.5" step="0.05" value="1.3"></div>
      <div class="row"><label title="Amplitud de velocidad A_V (m/s). Amplitud de variación de la velocidad: V(t) = V₀ + A_V·sin(2πft)">amp V (m/s) <b id="ampVv"></b></label><input id="ampV" type="range" min="0" max="1.2" step="0.05" value="0.5"></div>
      <div class="row"><label title="Amplitud de θ A_θ (°). Amplitud de variación del ángulo de ataque: θ(t) = θ₀ + A_θ·sin(2πft + φ_θ)">amp θ base (°) <b id="ampTv"></b></label><input id="ampT" type="range" min="0" max="4" step="0.1" value="1.5"></div>
      <div class="row"><label title="Amplitud de γ A_γ (°). Amplitud de variación del ángulo de flujo: γ(t) = γ₀ + A_γ·sin(2πft + φ_γ)">amp γ (°) <b id="ampGv"></b></label><input id="ampG" type="range" min="0" max="5" step="0.1" value="1.8"></div>
      <div class="row"><label title="Fase de θ φ_θ (°). Desfase de fase para θ(t). Ángulo en grados para el seno.">fase θ (°) <b id="phaseTv"></b></label><input id="phaseT" type="range" min="0" max="180" step="5" value="60"></div>
      <div class="row"><label title="Fase de γ φ_γ (°). Desfase de fase para γ(t). Ángulo en grados para el seno.">fase γ (°) <b id="phaseGv"></b></label><input id="phaseG" type="range" min="0" max="180" step="5" value="110"></div>
      <div class="row"><label title="Paso de integración Δt (s). Paso de tiempo para el integrador numérico. Afecta precisión y velocidad de simulación.">Δt (s) <b id="dtv"></b></label><input id="dtStep" type="range" min="0.001" max="0.02" step="0.001" value="0.004"></div>
    </div>

    <h1>Rider</h1>
    <div class="section">
      <div class="row"><label title="Reparto estático λ (adimensional). Fracción de peso apoyada en el pie delantero. λ = F_delantero / Peso_total">λ reparto (front) <b id="lambdav"></b></label><input id="lambda" type="range" min="0.3" max="0.7" step="0.01" value="0.55"></div>
      <div class="row"><label title="Distancia entre pies d (m). Distancia horizontal entre los puntos de apoyo de los pies.">d stance (m) <b id="dv"></b></label><input id="dstance" type="range" min="0.4" max="0.9" step="0.01" value="0.70"></div>
      <div class="row"><label title="Amplitud delantera A_f (N). Amplitud de fuerza adicional en el pie delantero. F_delantero(t) = λ·mg + A_f·sin(2πft + φ_f)">A_f (N) <b id="Afv"></b></label><input id="Af" type="range" min="0" max="600" step="5" value="120"></div>
      <div class="row"><label title="Amplitud trasera A_b (N). Amplitud de fuerza adicional en el pie trasero. F_trasero(t) = (1-λ)·mg + A_b·sin(2πft + φ_b)">A_b (N) <b id="Abv"></b></label><input id="Ab" type="range" min="0" max="600" step="5" value="220"></div>
      <div class="row"><label title="Fase delantera φ_f (°). Fase para la fuerza del pie delantero.">fase_f (°) <b id="phifv"></b></label><input id="phaseF" type="range" min="0" max="180" step="5" value="0"></div>
      <div class="row"><label title="Fase trasera φ_b (°). Fase para la fuerza del pie trasero.">fase_b (°) <b id="phibv"></b></label><input id="phaseB" type="range" min="0" max="180" step="5" value="60"></div>
      <div class="row"><label title="Ganancia θ G_θ (°/(N·m)). Ganancia del ángulo de ataque respecto al momento del rider: θ_eff = θ₀ - G_θ·M_rider">Gθ (deg/(N·m)) <b id="Gthv"></b></label><input id="Gtheta" type="range" min="0" max="0.03" step="0.0005" value="0.004"></div>
      <div class="row"><label title="Ganancia φ K_φ (°/(N·m)). Ganancia del ángulo φ respecto al momento del rider: φ_eff = φ₀ - K_φ·M_rider">Kφ (deg/(N·m)) <b id="Kphiv"></b></label><input id="Kphi" type="range" min="0" max="0.15" step="0.0005" value="0.050"></div>
      <div class="row"><label title="Altura inicial h₀ (m). Altura inicial del centro de presión. Negativo = bajo el agua. Positivo = sobre el agua.">h₀ (m, <i>negativo</i>) <b id="h0v"></b></label><input id="h0" type="range" min="-0.8" max="0.2" step="0.01" value="-0.20"></div>
      <div class="row"><label title="Amortiguamiento vertical c_w (N·s/m). Coeficiente de amortiguamiento vertical. F_amort = -c_w·v_vertical">c_w (N·s/m) <b id="cwv"></b></label><input id="cw" type="range" min="0" max="400" step="5" value="150"></div>
      <div class="row"><label title="Escala vertical (px/m). Factor de escala para la dimensión vertical en el diagrama (píxeles por metro).">escala vertical (px/m) <b id="vscalev"></b></label><input id="vscale" type="range" min="200" max="2000" step="20" value="600"></div>
      <div class="row"><label title="Escala horizontal (px/m). Factor de escala para longitudes horizontales en el diagrama (píxeles por metro).">escala horizontal (px/m) <b id="hscalev"></b></label><input id="hscale" type="range" min="60" max="240" step="5" value="110"></div>
      <div class="row"><label title="Escala velocidad (adimensional). Factor de escala para los vectores de velocidad en el diagrama.">escala velocidad (×) <b id="velscalev"></b></label><input id="velscale" type="range" min="0.1" max="6" step="0.1" value="1.8"></div>
      <div class="row" style="font-size:11px;color:#666;">
        <span>Límites vel.:</span>
        <input id="velscaleMin" type="number" min="0.01" max="10" step="0.1" value="0.1" style="width:50px;margin-left:5px;">
        <span> - </span>
        <input id="velscaleMax" type="number" min="0.1" max="20" step="0.1" value="6" style="width:50px;">
      </div>
      <div class="row"><label title="Escala fuerzas (adimensional). Factor de escala para los vectores de fuerza en el diagrama.">escala fuerzas (×) <b id="fuerzascalev"></b></label><input id="fuerzascale" type="range" min="0.1" max="6" step="0.1" value="1.8"></div>
      <div class="row" style="font-size:11px;color:#666;">
        <span>Límites fuerzas:</span>
        <input id="fuerzascaleMin" type="number" min="0.01" max="10" step="0.1" value="0.1" style="width:50px;margin-left:5px;">
        <span> - </span>
        <input id="fuerzascaleMax" type="number" min="0.1" max="20" step="0.1" value="6" style="width:50px;">
      </div>
    </div>

    <h1>Tabla &amp; Mástil</h1>
    <div class="section">
      <div class="row"><label title="Volumen tabla (L). Volumen de la tabla para cálculo de empuje de Arquímedes.">Volumen tabla (L) <b id="volv"></b></label><input id="boardVolL" type="range" min="40" max="140" step="1" value="90"></div>
      <div class="row"><label title="Superficie tabla (m²). Área de la superficie mojada de la tabla para cálculo de empuje de Arquímedes.">Superficie tabla (m²) <b id="areav"></b></label><input id="boardArea" type="range" min="0.40" max="1.20" step="0.01" value="0.75"></div>
      <div class="row"><label title="Altura mástil (m). Altura desde la tabla hasta el foil.">Altura mástil (m) <b id="mastv"></b></label><input id="mastH" type="range" min="0.60" max="1.20" step="0.01" value="0.85"></div>
      <div class="row"><label title="Longitud tabla (m). Longitud total de la tabla para representación gráfica.">L tabla (m) <b id="Ltabv"></b></label><input id="boardLen" type="range" min="1.10" max="1.90" step="0.01" value="1.50"></div>
    </div>

    <h1>Vista</h1>
    <div class="section checks">
      <label><input id="showHorizon" type="checkbox" checked> Mostrar superficie</label>
      <label><input id="showFeet" type="checkbox" checked> Mostrar flechas de pies</label>
      <label><input id="showArc" type="checkbox" checked> Mostrar arco de α</label>
      <label><input id="showLabels" type="checkbox" checked> Mostrar etiquetas</label>
      <label><input id="phiFollow" type="checkbox" checked> φ sigue momento (Kφ·M_rider)</label>
      <label><input id="showFlow" type="checkbox" checked> Mostrar vector de flujo (γ)</label>
      <label><input id="showChord" type="checkbox" checked> Mostrar cuerda (θ_eff)</label>
      <label><input id="showLD" type="checkbox" checked> Mostrar vectores L/D</label>
      <label><input id="showTableVel" type="checkbox" checked> Mostrar velocidad tabla</label>
      <label><input id="showAxesW" type="checkbox" checked> Ejes globales W</label>
      <label><input id="showAxesB" type="checkbox" checked> Ejes en tabla B</label>
      <label><input id="showWeight" type="checkbox" checked> Mostrar peso (mg)</label>
      <label><input id="showBuoy" type="checkbox" checked> Mostrar Arquímedes</label>
      <label><input id="showResultants" type="checkbox" checked> Mostrar resultantes</label>
<label><input id="useODE" type="checkbox" checked> Modo físico (ODE) - RECOMENDADO</label>
    </div>
  </div>

  <div class="col center">
    <h1>Diagrama geométrico</h1>
    <div class="diagram"><svg id="geom"></svg></div>
    <div class="controls">
      <button class="btn" id="back">&#9664;&#9664; Step</button>
      <button class="btn" id="playPause">▶ Play</button>
      <button class="btn" id="fwd">Step &#9654;&#9654;</button>
      <span>t = <b id="tVal">0.00</b> s</span>
      <span>| Pan:</span>
      <button class="btn" id="panL">←</button>
      <button class="btn" id="panU">↑</button>
      <button class="btn" id="panD">↓</button>
      <button class="btn" id="panR">→</button>
      <button class="btn" id="pan0">Reset</button>
      <button class="btn" id="state0">Reset estado</button>
    </div>
  </div>

  <div class="col right">
    <h1>KPI</h1>
    <div class="kpis">
      <div class="kpi"><div class="h" title="Ángulo de ataque α (°). Ángulo entre la cuerda del ala y la velocidad relativa del flujo. Positivo cuando el borde de ataque está arriba (convención aerodinámica estándar). α = θ_eff - γ">α (°)</div><div class="v" id="alphaOut">—</div></div>
      <div class="kpi"><div class="h" title="Ángulo efectivo θ_eff (°). Ángulo efectivo de la cuerda considerando el efecto del rider. θ_eff = θ₀ - G_θ·M_rider">θ_eff (°)</div><div class="v" id="thetaEffOut">—</div></div>
      <div class="kpi"><div class="h" title="Sustentación L (N). Componente de sustentación hidrodinámica. L = ½·ρ·V²·S·CL">L (N)</div><div class="v" id="LOut" style="color:#2e7d32">—</div></div>
      <div class="kpi"><div class="h" title="Sustentación vertical L_v (N). Componente vertical de la sustentación. L_v = L·cos(γ)">L vertical (N)</div><div class="v" id="LvOut" style="color:#2e7d32">—</div></div>
      <div class="kpi"><div class="h" title="Fuerza rider vertical (N). Fuerza vertical total ejercida por el rider (pies delantero + trasero).">F_rider vert. (N)</div><div class="v" id="FrOut" style="color:#c00">—</div></div>
      <div class="kpi"><div class="h" title="Resistencia D (N). Componente de resistencia hidrodinámica. D = L / (L/D)">D (N)</div><div class="v" id="DOut">—</div></div>
      <div class="kpi"><div class="h" title="Empuje horizontal (N). Componente horizontal de la fuerza hidrodinámica. Th = L_x + D_x">Empuje (N)</div><div class="v" id="ThOut">—</div></div>
      <div class="kpi"><div class="h" title="Porcentaje de soporte (%). Porcentaje de soporte hidrodinámico: Sup = (L_v + F_Arquímedes) / mg × 100%">% soporte</div><div class="v" id="SupOut">—</div></div>
      <div class="kpi"><div class="h" title="Momento rider M_rider (N·m). Momento ejercido por el rider alrededor del centro de presión. M_rider = (F_trasero - F_delantero) × d/2">M_rider (N·m)</div><div class="v" id="MrOut">—</div></div>
      <div class="kpi"><div class="h" title="Altura CoP h (m). Altura del centro de presión relativa a la superficie del agua.">h<sub>CoP</sub> (m)</div><div class="v" id="hOut">—</div></div>
      <div class="kpi"><div class="h" title="Velocidad tabla V_tabla (m/s). Velocidad total de la tabla: V_tabla = √(u² + w²)">V_tabla (m/s)</div><div class="v" id="VTableOut" style="color:#0066cc">—</div></div>
      <div class="kpi"><div class="h" title="Empuje Arquímedes (N). Fuerza de empuje hidrostático: F_Arquímedes = ρ·g·V_submergido">Empuje Arq. (N)</div><div class="v" id="BOut">—</div></div>
      <div class="kpi"><div class="h" title="Calado tabla (m). Profundidad de inmersión de la tabla en el agua.">Calado tabla (m)</div><div class="v" id="draftOut">—</div></div>
    </div>
    <h1>Histórico</h1>
    <div class="chartbox"><svg id="chartAngles"></svg></div>
    <div class="chartbox"><svg id="chartForces"></svg></div>
  </div>
</div>

<script src="sim.js" defer></script>
</body>
</html>
